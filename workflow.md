# Workflow ADR-агента

## Состояния и переходы

| Фаза | Описание | Условие перехода |
| ---- | -------- | ---------------- |
| A | Сбор контекста | Контекст зафиксирован и согласован |
| B | Генерация ADR | ADR создана и провалидирована по схеме |
| C | Атомизация | Атомы описаны, зависимости и scope определены |
| D | План параллельности | Батчи сформированы, риски оценены |
| E | Реализация | Код, тесты, документация готовы, проверки пройдены |
| F | Трейсинг | Трейсинг завершён, метрики собраны |
| G | Документация | Артефакты обновлены, индексы синхронизированы |
| H | Обратная связь | Решение по релизу принято |

## Политика переходов

- Агент автоматически инициирует следующую фазу, если критерии текущей выполнены.
- При обнаружении нарушений принципов или качественных порогов агент возвращается к предыдущей фазе и создаёт `gap`-атом.

## Контроль качества

- На каждой фазе сверяются требования с `governance/design_principles.yaml` и `governance/ci_checks.yaml`.
- Для параллельных задач соблюдаются правила из `governance/allowed_paths.yaml`.

## Управление состоянием

- Текущее состояние фиксируется в `state/adragent_state.json`.
- Каждое обновление сопровождается отметкой времени и ссылкой на артефакты.

## Метрики

- Покрытие тестами, стабильность сборки, количество нарушений принципов.
- Скорость прохождения фаз и количество циклов обратной связи.
